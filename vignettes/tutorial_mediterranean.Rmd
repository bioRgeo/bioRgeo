---
title: "Tutorial with Mediterranean example"
author: "Pierre Denelle"
date: "`r Sys.Date()`"
output: 
  html_vignette:
    number_sections: true
vignette: >
 %\VignetteIndexEntry{Tutorial for bioRgeo R package}
 %\VignetteEngine{knitr::rmarkdown}
 %\VignetteEncoding{UTF-8} 
editor_options: 
chunk_output_type: console
---

<style>
body {
text-align: justify}
</style>

The principle of the package is illustrated by the following figure.

```{r package_scheme, fig.label = "Workflow of the package."}
knitr::include_graphics("../figures/Bioregionalization_scheme3.png")
```

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
                      fig.width = 12, fig.height = 12)
# Packages --------------------------------------------------------------------
suppressPackageStartupMessages({
  suppressWarnings({
    library(Bioregionalization)
    library(dplyr)
    library(sf)
    library(ggplot2)
    library(cowplot)
    library(igraph)
    library(RColorBrewer)
  })
})

options(tinytex.verbose = TRUE)

```

Another dataset is available within *Bioregionalization* and all the above
analyses can be run in an identical fashion.

```{r mediterreanean}
# Import Mediterranean dataset
data("medit")

# Plot of Mediterranean area
medit[[2]] %>%
  ggplot() +
  geom_sf() +
  labs(title = expression("Mediterranean area, resolution 40x40km"^2),
       x = "Longitude", y = "Latitude")

sp_df <- medit[[1]] %>%
  rename(site = id) %>%
  mutate(site = as.character(site),
         sp = as.character(sp))

# Random vector of abundances assigned for weighted networks
sp_df$ab <- runif(n = nrow(sp_df), min = 0, max = 1)

colnames(medit[[2]]) <- c("site", "geometry")
medit[[2]]$site <- as.character(medit[[2]]$site)
colnames(medit[[2]]) <- c("site", "geometry")

```

```{r fig_network_analysis, fig.label = "Steps of the biogeographical network analysis.1.Biogeographical bipartite network where grid cells and species are linked by the presence of a species (or a group of species) in a given grid cell during a certain time window. Note that there is no link between nodes belonging to the same set. 2.The bipartite network is then spatially projected by using a similarity measure of species composition between grid cells.Bioregions are then identified with a network community detection algorithm.3.The test value matrix based on the contribution of species to bioregions is computed. 4. Then, a network of similarity between species is built, based on the test value matrix. Groups of species sharing similar spatial features are identified using a community detection algorithm. 5.Finally, a coarseâ€grained biogeographical network unveiling the biogeographical structure of the studied area and the relationship between bioregions is obtained."}
knitr::include_graphics("../figures/Lenormand_et_al_2019_Figure2.png")
```
